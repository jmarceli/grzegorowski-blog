{"componentChunkName":"component---gatsby-ghost-theme-src-templates-post-js","path":"/wordpress-rewrite-rules/amp/","webpackCompilationHash":"74957d360c0907da843a","result":{"data":{"post":{"html":"<p>If you are making larger Wordpress site at some point you will definitely come across custom rewrite rules configuration.</p>\n<h2>The tools (plugins)</h2>\n<p>I would suggest <a href=\"https://wordpress.org/plugins/monkeyman-rewrite-analyzer/\">Rewrite Analyzer</a> as it shows matched URL parts which is very convenient for debugging.</p>\n<h2>Prioritize pagination over Custom Post Type (CPT) slug</h2>\n<p>So you want to have clean URL structure for your CPT archive, so the list page has the same URL as single CPT pages <strong>slug</strong> prefix.</p>\n<p>Here is the URLs structure I'm talking about:</p>\n<ul>\n<li><code class=\"language-text\">/career</code> - page with CPT archive</li>\n<li><code class=\"language-text\">/career/page/2</code> - second page of CPT archive</li>\n<li><code class=\"language-text\">/career/some-position-offer</code> - single CPT page</li>\n</ul>\n<p>Such URL structure requires defining a custom rewrite rule.</p>\n<p>Out of the box Wordpress fail to route to the <code class=\"language-text\">/career/page/2</code>, because before looking for the second page it will try to find CPT (named <code class=\"language-text\">career</code> in this example) with <code class=\"language-text\">page/2</code> slug. As a result the visitor will go to the 404 page instead of the second page for the Post archive.</p>\n<p>It's quite easy to solve with <code class=\"language-text\">add_rewrite_rule</code> function. Write following PHP code into your theme/plugin <code class=\"language-text\">functions.php</code> file (or anywhere else where you store custom PHP code for Wordpress):</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-php line-numbers\"><code class=\"language-php\"><span class=\"token comment\">// functions.php</span>\n<span class=\"token comment\">// prioritetize pagination over displaying custom post type content</span>\n<span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'init'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">add_rewrite_rule</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'(.?.+?)/page/?([0-9]{1,})/?$'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'index.php?pagename=$matches[1]&amp;paged=$matches[2]'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'top'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>If you do that the Wordpress will try to find next page before it tries to find the CPT single page.</p>\n<p>For more info about <code class=\"language-text\">add_rewrite_rule</code> check out the official documentation <a href=\"https://developer.wordpress.org/reference/functions/add_rewrite_rule/\">https://developer.wordpress.org/reference/functions/add<em>rewrite</em>rule/</a>.</p>\n<h2>Restricting selected slugs in Wordpress</h2>\n<p>Sometimes, especially when you start messing with the default URL structure there might be a necessity of restricting some slugs. Here is an example which will show how to prevent Post slug collisions with the existing Categories slugs <code class=\"language-text\">functions.php</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-php line-numbers\"><code class=\"language-php\"><span class=\"token comment\">// functions.php</span>\n<span class=\"token comment\">// Prevent category - post slug collisions</span>\n<span class=\"token comment\">// Restrict selected slugs for posts</span>\n<span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span> <span class=\"token single-quoted-string string\">'wp_unique_post_slug'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$slug</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$post_ID</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$post_status</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$post_type</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token single-quoted-string string\">'post'</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$post_type</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$categories</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_categories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$categories</span> <span class=\"token operator\">=</span> <span class=\"token function\">array_map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$c</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token variable\">$c</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">slug</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$categories</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">in_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$slug</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$categories</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token variable\">$slug</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'-'</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$post_ID</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token variable\">$slug</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This code will append <code class=\"language-text\">-[post_ID]</code> to the end of the Post slug if it happens to be same as on of the slugs for existing categories.</p>\n<p>All examples are written for PHP >= 5.4.</p>\n<h2>Issues</h2>\n<p>Problems with pagination, rewrite rules and generally URL structure.</p>\n<ol>\n<li>Don't name query variable same as existing taxonomy slug. So if you have taxonomy with slug <code class=\"language-text\">company</code> avoid using <code class=\"language-text\">?company=xyz</code> as a query variable.</li>\n<li>If you want to change number of <code class=\"language-text\">posts_per_page</code> on default Wordpress post list page you should change this number not only in <code class=\"language-text\">query_args</code> array but also in Wordpress settings. In other case (if you change just <code class=\"language-text\">query_args</code>) you will get into troubles with pagination.</li>\n</ol>","excerpt":"If you are making larger Wordpress site at some point you will definitely come across custom rewrite rules configuration. The tools (plugins…","timeToRead":2,"frontmatter":{"author":"jan","feature_image":null,"title":"Wordpress rewrite rules and pagination","slug":"wordpress-rewrite-rules","date":"2017-07-17T16:54:23.000Z","tags":["wordpress"],"date_created":"2017-07-15T15:13:43.000Z","date_updated":"2017-08-30T02:21:57.000Z","featured":false}},"similarPosts":{"edges":[{"node":{"timeToRead":1,"excerpt":"Adding WPML support to PostType Switcher plugin is easy. My solution is based on https://wordpress.org/support/topic/simple-hack-to-add-wpml…","frontmatter":{"title":"Wordpress WMPL Post Type Switcher support","slug":"wordpress-wmpl-post-type-switcher-support","date":"2017-10-05T19:28:00.000Z","tags":["wordpress","wordpress-plugins","php"],"date_created":"2017-10-05T19:28:03.000Z","date_updated":"2017-10-05T19:40:21.000Z","featured":false,"author":"jan","feature_image":null}}},{"node":{"timeToRead":2,"excerpt":"Adding translations to the current Roots Sage version (which is 9.0.0-beta.4) is not as easy and standard as it was in previous versions…","frontmatter":{"title":"Wordpress Roots Sage 9 translations","slug":"wordpress-roots-sage-9-translations","date":"2017-08-31T01:26:13.000Z","tags":["wordpress"],"date_created":"2017-08-31T00:57:15.000Z","date_updated":"2017-09-22T22:17:04.000Z","featured":false,"author":"jan","feature_image":{"absolutePath":"/Users/janek/work/github_contrib/grzegorowski.com/blog/content/posts/img/letters.jpg","relativePath":"posts/img/letters.jpg","childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBP/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB40mboH//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAACAwEAAAAAAAAAAAAAAAAAUQEQEWH/2gAIAQEAAT8htELph//aAAwDAQACAAMAAAAQ2O//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEBAQADAQAAAAAAAAAAAAABEQBBUZGx/9oACAEBAAE/EAAzDU5Zlr1d9B5iy2b/2Q==","aspectRatio":2,"src":"/static/07579ef4c70caa9b105d77ba1fcee8ad/0defe/letters.jpg","srcSet":"/static/07579ef4c70caa9b105d77ba1fcee8ad/38b6a/letters.jpg 150w,\n/static/07579ef4c70caa9b105d77ba1fcee8ad/e201c/letters.jpg 300w,\n/static/07579ef4c70caa9b105d77ba1fcee8ad/0defe/letters.jpg 600w,\n/static/07579ef4c70caa9b105d77ba1fcee8ad/a71f1/letters.jpg 900w,\n/static/07579ef4c70caa9b105d77ba1fcee8ad/9f6c3/letters.jpg 1200w,\n/static/07579ef4c70caa9b105d77ba1fcee8ad/e95fb/letters.jpg 1280w","sizes":"(max-width: 600px) 100vw, 600px"}}}}}},{"node":{"timeToRead":2,"excerpt":"During assets compilation with ,  or  you may run into this error: error Command failed with exit code 2  Workaround In order to fix it try…","frontmatter":{"title":"Roots Sage 9.0.0 - error Command failed with exit code 2","slug":"wordpress-roots-sage-9-0-0","date":"2017-08-24T02:05:40.000Z","tags":["wordpress"],"date_created":"2017-08-24T01:53:35.000Z","date_updated":"2018-01-28T11:19:15.000Z","featured":false,"author":"jan","feature_image":{"absolutePath":"/Users/janek/work/github_contrib/grzegorowski.com/blog/content/posts/img/sage_assets_errors_reporting.jpg","relativePath":"posts/img/sage_assets_errors_reporting.jpg","childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAcSEBX//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAE/IX//2gAMAwEAAgADAAAAEP8A3//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/EIf/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxCn/8QAFxABAQEBAAAAAAAAAAAAAAAAAQARcf/aAAgBAQABPxBeyO2X/9k=","aspectRatio":2,"src":"/static/90a2aa5953a511a05142d0b453a3e842/0defe/sage_assets_errors_reporting.jpg","srcSet":"/static/90a2aa5953a511a05142d0b453a3e842/38b6a/sage_assets_errors_reporting.jpg 150w,\n/static/90a2aa5953a511a05142d0b453a3e842/e201c/sage_assets_errors_reporting.jpg 300w,\n/static/90a2aa5953a511a05142d0b453a3e842/0defe/sage_assets_errors_reporting.jpg 600w,\n/static/90a2aa5953a511a05142d0b453a3e842/a71f1/sage_assets_errors_reporting.jpg 900w,\n/static/90a2aa5953a511a05142d0b453a3e842/9f6c3/sage_assets_errors_reporting.jpg 1200w,\n/static/90a2aa5953a511a05142d0b453a3e842/e95fb/sage_assets_errors_reporting.jpg 1280w","sizes":"(max-width: 600px) 100vw, 600px"}}}}}},{"node":{"timeToRead":1,"excerpt":"The most useful feature of the ACF Wordpress plugin is its PHP API. Unfortunately, it is not fully documented on the official page. Here are…","frontmatter":{"title":"ACF PHP API the missing docs","slug":"acf-php-api-the-missing-docs","date":"2017-05-08T13:28:50.000Z","tags":["wordpress","acf"],"date_created":"2017-04-27T12:05:05.000Z","date_updated":"2017-08-18T13:09:10.000Z","featured":false,"author":"jan","feature_image":null}}},{"node":{"timeToRead":1,"excerpt":"Getting a list of all ACF fields may be useful e.g. if you want the user to select one of them as a data source. In my case, I needed that…","frontmatter":{"title":"How to get list of all ACF fields?","slug":"how-to-get-list-of-all-acf-fields","date":"2017-04-19T21:59:51.000Z","tags":["wordpress","acf"],"date_created":"2017-04-19T21:47:43.000Z","date_updated":"2017-10-17T02:13:16.000Z","featured":false,"author":"jan","feature_image":null}}}]},"authors":{"edges":[{"node":{"id":"1","slug":"jan","name":"Jan Grzegorowski","bio":"Full-stack developer currently working with React / Java stack","website":"","location":"","profile_image":{"relativePath":"avatar/photo-mini.jpg","childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUEAv/EABQBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAa8+nhDphjnIF7Ah/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAAxEiMf/aAAgBAQABBQK5mUB762lg1VGvG8Udif/EABcRAQEBAQAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8BAyHJ/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/ATUav//EABsQAQACAgMAAAAAAAAAAAAAAAECEgAQESAx/9oACAEBAAY/Agh64Wbx56u//8QAHBABAAIDAAMAAAAAAAAAAAAAAQARECExgaGx/9oACAEBAAE/IRAL6t4R+NaJW948RDMDnzHpQyxFZP/aAAwDAQACAAMAAAAQD8A8/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAx/9oACAEDAQE/EGNZvP/EABYRAQEBAAAAAAAAAAAAAAAAAAEQMf/aAAgBAgEBPxBJGE//xAAcEAEBAAICAwAAAAAAAAAAAAABEQAhEDFRgcH/2gAIAQEAAT8Qfyh9bKr5wsWRAIpRh0prgVXZTPUxvgwCqwb+cGlgG6ILpxBXtz//2Q==","width":30,"height":30,"src":"/static/2b64da00e4a3f2952c8d9e3a6b631208/a6b89/photo-mini.jpg","srcSet":"/static/2b64da00e4a3f2952c8d9e3a6b631208/a6b89/photo-mini.jpg 1x,\n/static/2b64da00e4a3f2952c8d9e3a6b631208/74c3b/photo-mini.jpg 1.5x,\n/static/2b64da00e4a3f2952c8d9e3a6b631208/9c097/photo-mini.jpg 2x"}}},"profile_image_large":{"relativePath":"avatar/photo-mini.jpg","childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUEAv/EABQBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAa8+nhDphjnIF7Ah/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAAxEiMf/aAAgBAQABBQK5mUB762lg1VGvG8Udif/EABcRAQEBAQAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8BAyHJ/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/ATUav//EABsQAQACAgMAAAAAAAAAAAAAAAECEgAQESAx/9oACAEBAAY/Agh64Wbx56u//8QAHBABAAIDAAMAAAAAAAAAAAAAAQARECExgaGx/9oACAEBAAE/IRAL6t4R+NaJW948RDMDnzHpQyxFZP/aAAwDAQACAAMAAAAQD8A8/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAx/9oACAEDAQE/EGNZvP/EABYRAQEBAAAAAAAAAAAAAAAAAAEQMf/aAAgBAgEBPxBJGE//xAAcEAEBAAICAwAAAAAAAAAAAAABEQAhEDFRgcH/2gAIAQEAAT8Qfyh9bKr5wsWRAIpRh0prgVXZTPUxvgwCqwb+cGlgG6ILpxBXtz//2Q==","width":60,"height":60,"src":"/static/2b64da00e4a3f2952c8d9e3a6b631208/9c097/photo-mini.jpg","srcSet":"/static/2b64da00e4a3f2952c8d9e3a6b631208/9c097/photo-mini.jpg 1x,\n/static/2b64da00e4a3f2952c8d9e3a6b631208/c5aad/photo-mini.jpg 1.5x"}}}}}]},"tags":{"edges":[{"node":{"id":"5b982ddf16b0a81519316f6c","name":"Wordpress","slug":"wordpress"}}]},"tagPosts":{"edges":[{"node":{"frontmatter":{"title":"Wordpress WMPL Post Type Switcher support","slug":"wordpress-wmpl-post-type-switcher-support","date":"2017-10-05T19:28:00.000Z","featured":false}}},{"node":{"frontmatter":{"title":"Wordpress Roots Sage 9 translations","slug":"wordpress-roots-sage-9-translations","date":"2017-08-31T01:26:13.000Z","featured":false}}},{"node":{"frontmatter":{"title":"Roots Sage 9.0.0 - error Command failed with exit code 2","slug":"wordpress-roots-sage-9-0-0","date":"2017-08-24T02:05:40.000Z","featured":false}}},{"node":{"frontmatter":{"title":"ACF PHP API the missing docs","slug":"acf-php-api-the-missing-docs","date":"2017-05-08T13:28:50.000Z","featured":false}}}],"totalCount":9}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"wordpress-rewrite-rules","tags":["wordpress"],"author":"jan","mainTag":"wordpress","prev":{"frontmatter":{"slug":"php-default-values-with-array_merge","tags":["php"],"author":"jan"}},"next":{"frontmatter":{"slug":"meteor-node-simple-schema-and-meteor-users-collection","tags":["meteor"],"author":"jan"}},"isAmp":true}}}