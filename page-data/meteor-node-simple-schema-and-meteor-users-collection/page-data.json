{"componentChunkName":"component---gatsby-ghost-theme-src-templates-post-js","path":"/meteor-node-simple-schema-and-meteor-users-collection","result":{"data":{"post":{"html":"<p>If you use Meteor you have to come across the <a href=\"https://github.com/aldeed/node-simple-schema\">node-simple-schema</a> formerly known as <code class=\"language-text\">meteor-simple-schema</code>. This is definitely a great package which eases data validation a lot by allowing you to define some schema for your MongoDB (which is schema-less DB).\nWhereas creating a schema for your custom data type is easy (just follow the <code class=\"language-text\">node-simple-schema</code> docs), integration with external packages may require some knowledge. As an example I will describe the process of writing a basic schema for the Accounts Meteor functionality and the <a href=\"https://docs.meteor.com/api/passwords.html\">accounts-password</a> package.</p>\n<h2>Educated guesses</h2>\n<p>There is no official documentation about Meteor Accounts and <code class=\"language-text\">node-simple-schema</code> integration, so (probably) the only way is to make some educated guesses about the internal structure of <code class=\"language-text\">Meteor.users</code> collection. The first place to look at is <a href=\"http://docs.meteor.com/api/accounts.html#Meteor-users\">http://docs.meteor.com/api/accounts.html#Meteor-users</a> (here is the relevant code):</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  _id<span class=\"token operator\">:</span> <span class=\"token string\">'QwkSmTCZiw5KDx3L6'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// Meteor.userId()</span>\n  username<span class=\"token operator\">:</span> <span class=\"token string\">'cool_kid_13'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Unique name</span>\n  emails<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// Each email address can only belong to one user.</span>\n    <span class=\"token punctuation\">{</span> address<span class=\"token operator\">:</span> <span class=\"token string\">'cool@example.com'</span><span class=\"token punctuation\">,</span> verified<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> address<span class=\"token operator\">:</span> <span class=\"token string\">'another@different.com'</span><span class=\"token punctuation\">,</span> verified<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  createdAt<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Wed Aug 21 2013 15:16:52 GMT-0700 (PDT)'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  profile<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// The profile is writable by the user by default.</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'Joe Schmoe'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  services<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    facebook<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      id<span class=\"token operator\">:</span> <span class=\"token string\">'709050'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Facebook ID</span>\n      accessToken<span class=\"token operator\">:</span> <span class=\"token string\">'AAACCgdX7G2...AbV9AZDZD'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    resume<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      loginTokens<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span> token<span class=\"token operator\">:</span> <span class=\"token string\">'97e8c205-c7e4-47c9-9bea-8e2ccc0694cd'</span><span class=\"token punctuation\">,</span>\n          when<span class=\"token operator\">:</span> <span class=\"token number\">1349761684048</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>After reading this short example you may have a general idea about the structure of data stored inside <code class=\"language-text\">users</code> collection. Based on that knowledge let's write some <code class=\"language-text\">SimpleSchema</code> related code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> SimpleSchema <span class=\"token keyword\">from</span> <span class=\"token string\">'simpl-schema'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Tracker <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'meteor/tracker'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> User <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  username<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span> label<span class=\"token operator\">:</span> <span class=\"token string\">\"Username\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  services<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> Object<span class=\"token punctuation\">,</span> blackbox<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  emails<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> Array<span class=\"token punctuation\">,</span> optional<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  createdAt<span class=\"token operator\">:</span> Date<span class=\"token punctuation\">,</span>\n  profile<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> Object<span class=\"token punctuation\">,</span> blackbox<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> optional<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> tracker<span class=\"token operator\">:</span> Tracker <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> User <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This seems to be the minimal working schema example for the Meteor <code class=\"language-text\">users</code> collection. As far as I know the <code class=\"language-text\">_id</code> field doesn't require to be defined inside SimpleSchema.</p>\n<h2>Adding accounts-password validation</h2>\n<p>If you are using <code class=\"language-text\">accounts-password</code> package (like I do) you may also specify the exact <code class=\"language-text\">services.password</code> keys for password type validation. Here is how it may look:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> SimpleSchema <span class=\"token keyword\">from</span> <span class=\"token string\">'simpl-schema'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Tracker <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'meteor/tracker'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> User <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  username<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span> label<span class=\"token operator\">:</span> <span class=\"token string\">\"Username\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  services<span class=\"token operator\">:</span> Object<span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'services.password'</span><span class=\"token operator\">:</span> Object<span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'services.password.bcrypt'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span> label<span class=\"token operator\">:</span> <span class=\"token string\">\"Password\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'services.resume'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> Object<span class=\"token punctuation\">,</span> blackbox<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> optional<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  emails<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> Array<span class=\"token punctuation\">,</span> optional<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  createdAt<span class=\"token operator\">:</span> Date<span class=\"token punctuation\">,</span>\n  profile<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> Object<span class=\"token punctuation\">,</span> blackbox<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> optional<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> tracker<span class=\"token operator\">:</span> Tracker <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> User <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The above example assumes that you are using only <code class=\"language-text\">password</code> package for other packages (e.g. <code class=\"language-text\">accounts-facebook</code>) you will have to specify correct <code class=\"language-text\">services.[package-name]</code> keys (e.g. <code class=\"language-text\">services.facebook.id</code>, <code class=\"language-text\">services.facebook.accessToken</code>).\nAnother thing worth noting is the <code class=\"language-text\">services.resume</code> key which is required in order to login user properly, because the data about existing sessions is stored inside <code class=\"language-text\">resume</code> object.</p>\n<p>In order to check if your schema works correctly you may execute a command like:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">Accounts<span class=\"token punctuation\">.</span><span class=\"token function\">createUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> password<span class=\"token operator\">:</span> <span class=\"token string\">'some_password'</span><span class=\"token punctuation\">,</span> username<span class=\"token operator\">:</span> <span class=\"token string\">'test123'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>From the Meteor interactive shell, you can open it when the meteor server is running with <code class=\"language-text\">meteor shell</code> command.</p>\n<h2>Conclusion</h2>\n<p>It's fairly easy to validate existing/external package data with <code class=\"language-text\">node-simple-schema</code> if only you know the internal structure of the validated data. If you are adding the validation to the existing app you may find it useful to check the database first with <code class=\"language-text\">meteor mongo</code> and <code class=\"language-text\">db.[your_collection].find()</code> to ensure that the collection structure matches your expectations.</p>","excerpt":"If you use Meteor you have to come across the node-simple-schema formerly known as . This is definitely a great package which eases dataâ€¦","timeToRead":3,"frontmatter":{"author":"jan","feature_image":{"absolutePath":"/Users/janek/work/github_contrib/grzegorowski.com/blog/content/posts/img/pexels-photo-30257.jpg","relativePath":"posts/img/pexels-photo-30257.jpg","publicURL":"/static/pexels-photo-30257-ded1ba9ed1686c5cfe854b1b68d9b14b.jpg","childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAgP/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAFGikvTQXCf/8QAGhAAAwADAQAAAAAAAAAAAAAAAAECAxETEv/aAAgBAQABBQJ4WcaPAqo6WbZ//8QAFREBAQAAAAAAAAAAAAAAAAAAECH/2gAIAQMBAT8Bh//EABYRAQEBAAAAAAAAAAAAAAAAAAAREv/aAAgBAgEBPwHSv//EABkQAAIDAQAAAAAAAAAAAAAAAAAxARAykf/aAAgBAQAGPwJCrUmp6M//xAAbEAEAAgIDAAAAAAAAAAAAAAABACEQMUGBkf/aAAgBAQABPyGnaIG8UME0HeDLcvZ//9oADAMBAAIAAwAAABAc/wD/xAAXEQADAQAAAAAAAAAAAAAAAAAAARFB/9oACAEDAQE/EI2Dh//EABcRAQADAAAAAAAAAAAAAAAAAAABYXH/2gAIAQIBAT8QmrD/xAAbEAEBAQACAwAAAAAAAAAAAAABEQAhYVFx0f/aAAgBAQABPxAQOSXg1wx8zTCY++ieFYze33IVV7W//9k=","aspectRatio":1.9722650231124808,"src":"/static/ded1ba9ed1686c5cfe854b1b68d9b14b/ec6c5/pexels-photo-30257.jpg","srcSet":"/static/ded1ba9ed1686c5cfe854b1b68d9b14b/9104c/pexels-photo-30257.jpg 480w,\n/static/ded1ba9ed1686c5cfe854b1b68d9b14b/a6352/pexels-photo-30257.jpg 960w,\n/static/ded1ba9ed1686c5cfe854b1b68d9b14b/ec6c5/pexels-photo-30257.jpg 1280w","sizes":"(max-width: 1280px) 100vw, 1280px"},"sizes":{"presentationHeight":406,"presentationWidth":800}}},"title":"Meteor node-simple-schema and Meteor.users collection","slug":"meteor-node-simple-schema-and-meteor-users-collection","tags":["meteor"],"date_created":"2017-07-14T15:00:18.000Z","date_updated":"2017-07-14T15:48:52.000Z","featured":false}},"similarPosts":{"edges":[]},"authors":{"edges":[{"node":{"id":"1","slug":"jan","name":"Jan Grzegorowski","bio":"Full-stack developer currently working with React / Java stack","website":"","location":"","profile_image":{"relativePath":"avatar/photo-mini.jpg","childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUEAv/EABQBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAa8+nhDphjnIF7Ah/8QAGhABAAMBAQEAAAAAAAAAAAAAAgABAxEiMf/aAAgBAQABBQLZI1T3zU0rpFdcXw17n//EABcRAQEBAQAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8BAyHJ/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/ATUav//EABsQAQACAgMAAAAAAAAAAAAAAAECEgAQESAx/9oACAEBAAY/Agh64Wbx56u//8QAHBABAAIDAAMAAAAAAAAAAAAAAQARECExgaGx/9oACAEBAAE/IRAL6t4R+NaJW948RBMDnzHpQyxBsn//2gAMAwEAAgADAAAAED/AfP/EABcRAAMBAAAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8QMsrdf//EABYRAQEBAAAAAAAAAAAAAAAAAAEQMf/aAAgBAgEBPxBJGE//xAAcEAEBAAICAwAAAAAAAAAAAAABEQAxECFRgcH/2gAIAQEAAT8Qfyh62Kr51hYtTAilGGl1wKr2dp6mJ8GAVsHfzg0nWAToxd4wrtz/2Q==","width":30,"height":30,"src":"/static/2b64da00e4a3f2952c8d9e3a6b631208/58a4b/photo-mini.jpg","srcSet":"/static/2b64da00e4a3f2952c8d9e3a6b631208/58a4b/photo-mini.jpg 1x,\n/static/2b64da00e4a3f2952c8d9e3a6b631208/f8771/photo-mini.jpg 1.5x,\n/static/2b64da00e4a3f2952c8d9e3a6b631208/56ed0/photo-mini.jpg 2x"}}},"profile_image_large":{"relativePath":"avatar/photo-mini.jpg","childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUEAv/EABQBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAa8+nhDphjnIF7Ah/8QAGhABAAMBAQEAAAAAAAAAAAAAAgABAxEiMf/aAAgBAQABBQLZI1T3zU0rpFdcXw17n//EABcRAQEBAQAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8BAyHJ/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAx/9oACAECAQE/ATUav//EABsQAQACAgMAAAAAAAAAAAAAAAECEgAQESAx/9oACAEBAAY/Agh64Wbx56u//8QAHBABAAIDAAMAAAAAAAAAAAAAAQARECExgaGx/9oACAEBAAE/IRAL6t4R+NaJW948RBMDnzHpQyxBsn//2gAMAwEAAgADAAAAED/AfP/EABcRAAMBAAAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8QMsrdf//EABYRAQEBAAAAAAAAAAAAAAAAAAEQMf/aAAgBAgEBPxBJGE//xAAcEAEBAAICAwAAAAAAAAAAAAABEQAxECFRgcH/2gAIAQEAAT8Qfyh62Kr51hYtTAilGGl1wKr2dp6mJ8GAVsHfzg0nWAToxd4wrtz/2Q==","width":60,"height":60,"src":"/static/2b64da00e4a3f2952c8d9e3a6b631208/56ed0/photo-mini.jpg","srcSet":"/static/2b64da00e4a3f2952c8d9e3a6b631208/56ed0/photo-mini.jpg 1x,\n/static/2b64da00e4a3f2952c8d9e3a6b631208/43396/photo-mini.jpg 1.5x"}}}}}]},"tags":{"edges":[{"node":{"id":"5b982ddf16b0a81519316f7f","name":"meteor","slug":"meteor"}}]},"tagPosts":{"edges":[],"totalCount":0}},"pageContext":{"slug":"meteor-node-simple-schema-and-meteor-users-collection","tags":["meteor"],"author":"jan","mainTag":"meteor","prev":{"frontmatter":{"slug":"wordpress-rewrite-rules","tags":["wordpress"],"author":"jan"}},"next":{"frontmatter":{"slug":"docker-and-vdebug-for-php-debugging","tags":["vim","tools"],"author":"jan"}}}}}